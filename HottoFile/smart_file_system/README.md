# 智能文件管理与检索系统

本项目是一个基于 Python 的智能文件管理与检索系统，能够自动解析、分类、索引和检索多种类型的文件。系统利用大语言模型（LLM）和向量嵌入技术，实现了强大的语义理解和搜索能力。

## ✨ 主要功能

- **自动文件监控**: 实时监控指定文件夹，自动处理新加入的文件。
- **多格式文件解析**: 支持解析文本文档 (`.txt`, `.md`) 和图像 (`.jpg`, `.png`)，并可轻松扩展以支持更多格式（如 `.pdf`）。
- **智能分类**:
    1.  **规则预分类**: 根据文件扩展名进行快速初步分类。
    2.  **语义分类**: 利用 **BGE-M3** Embedding 模型和 **FAISS** 向量数据库进行相似度匹配，找到候选分类。
    3.  **LLM 精准分类**: 调用大语言模型（如 GPT-3.5-turbo）对文件内容和候选分类进行分析，给出最精准的语义标签（例如“科研论文”、“代码脚本”等）。
- **语义检索**: 用户可以输入自然语言查询，系统会通过向量相似度搜索，返回最相关的已索引文件。
- **反馈学习机制**: 用户可以手动修正文件的分类结果，系统会记录这些反馈，为未来的模型优化和迭代提供数据基础。

## ⚙️ 系统架构

系统采用主系统 + 子系统的分层架构，各模块职责分明，易于维护和扩展。

```
┌────────────────────┐
│      主系统(调度)   │
│  - 监听目标文件夹   │
│  - 调用各分系统API │
│  - 提供交互接口     │
└─────────┬──────────┘
          │
┌─────────┴─────────┐
│  文件处理工作流     │
└─────────┬─────────┘
          │
┌─────────▼─────────┐
│  文件监控子系统     │
│ (FileMonitor)     │
└─────────┬─────────┘
          │
┌─────────▼─────────┐
│  文件解析子系统     │
│ (FileParser)      │
└─────────┬─────────┘
          │
┌─────────▼─────────┐
│  分类子系统         │
│ (Classifier)      │
└─────────┬─────────┘
          │
┌─────────▼─────────┐
│  向量化与存储子系统 │
│(EmbeddingManager) │
└─────────┬─────────┘
          │
┌─────────▼─────────┐
│  学习子系统         │
│(FeedbackManager)  │
└───────────────────┘
```

## 🚀 工作流程

1.  **文件放入**: 用户将文件添加到 `monitored_files` 文件夹。
2.  **触发处理**: **FileMonitor** 检测到新文件，并调用主处理函数。
3.  **内容解析**: **FileParser** 读取文件，提取文本内容（图像则使用 OCR），并生成内容摘要。
4.  **智能分类**: **Classifier** 依次执行规则、Embedding 和 LLM 分类，为文件打上类型和语义标签。
5.  **向量化存储**: **EmbeddingManager** 将文件的摘要文本转换成向量，并与文件信息一同存入 FAISS 向量索引中。
6.  **用户交互**:
    -   **检索**: 用户通过命令行输入 `search`，系统利用 **EmbeddingManager** 进行向量相似度搜索。
    -   **反馈**: 用户通过 `feedback` 命令修正分类，**FeedbackManager** 记录修正信息。

## 📂 项目结构

```
smart_file_system/
│
├── monitored_files/      # 需要监控的文件夹，将文件放入此处
│
├── data_structures/
│   ├── __init__.py
│   └── file_info.py        # 定义 FileInfo 数据结构
│
├── subsystems/
│   ├── __init__.py
│   ├── classifier.py       # 实现三层分类逻辑
│   ├── embedding_manager.py# 管理向量模型和 FAISS 数据库
│   ├── feedback_manager.py # 管理用户反馈
│   ├── file_monitor.py     # 监控文件系统变动
│   └── file_parser.py      # 解析文件内容和元数据
│
├── utils/
│   └── __init__.py         # 工具函数（当前为空）
│
├── main.py                 # 主程序入口和总调度器
├── requirements.txt        # 项目依赖
└── README.md               # 本文档
```

## 🛠️ 安装与设置

1.  **克隆或下载项目**: 将本项目代码下载到您的本地机器。

2.  **安装依赖**: 确保您已安装 Python 3.10+。打开终端，进入项目根目录 (`D:\HottoCreate\smart_file_system`)，然后运行以下命令安装所有必需的库：
    ```bash
    pip install -r requirements.txt
    ```
    *注意：如果遇到 `pytesseract` 的 `TesseractNotFoundError`，您需要单独安装 [Tesseract OCR 引擎](https://github.com/tesseract-ocr/tesseract) 并将其路径添加到系统环境变量中。*

3.  **设置 API 密钥**:
    -   **必需**: 本项目需要 OpenAI API 密钥才能使用 LLM 进行分类和摘要。请在您的操作系统中设置一个名为 `OPENAI_API_KEY` 的环境变量，并将其值设置为您的有效密钥。
    -   **可选**: 如果您使用代理或自定义的 API 服务，可以同时设置 `OPENAI_API_BASE` 环境变量。

## ▶️ 如何使用

1.  **启动系统**: 在终端中，导航到 `D:\HottoCreate` 目录，然后执行以下命令来启动主程序：
    ```bash
    python smart_file_system/main.py
    ```

2.  **添加文件**: 系统启动后，会自动创建 `smart_file_system/monitored_files` 文件夹。将您想要处理的文件（例如 `.txt`, `.md`, `.jpg` 等）复制或移动到这个文件夹中。

3.  **查看处理结果**: 系统会自动检测到新文件并开始处理。您将在终端中看到每个文件的处理日志，包括文件类型、内容摘要和最终的语义标签。

4.  **交互式命令**: 在系统运行的终端中，您可以使用以下命令进行交互：
    -   `search`:
        -   输入 `search` 并按回车。
        -   根据提示输入您想查询的自然语言文本（例如 "关于人工智能的论文"）。
        -   系统将返回最相似的三个文件及其相似度得分。
    -   `feedback`:
        -   输入 `feedback` 并按回车。
        -   根据提示输入您想要修正的文件的 `File ID`（该 ID 会在文件处理完成时显示）。
        -   输入您认为正确的标签。系统将记录您的反馈。
    -   `exit`:
        -   输入 `exit` 来安全地停止文件监控并关闭程序。

## 📦 依赖项

本项目依赖于以下 Python 库：

- `langchain`
- `faiss-cpu`
- `sentence-transformers`
- `transformers`
- `opencv-python`
- `pillow`
- `pytesseract`
- `openai`
- `watchdog`
